# Gravitational fields in spherical coordinates using Tesseroids with variable density

## Introduction

When computing gravitational fileds on regional or global scales it's necessary to take
into account the curvature of the Earth. One way to do this is using spherical prisms,
also known as Tesseroids.
One common approach to numerically solve the integrals that define the gravitational
fields generated by Tesseroids is to apply a Gauss-Legendre Quadrature (GQL).
Nevertheless, most methodologies consider only Tesseorids with homogeneous density or
with specific density variations in depth, like linear or polynomial.
We propose a new methodology to compute the gravitational fields generated by
Tesseroids with any continuous density variation in depth through GLQ and two
discretization algorithms.

> Imagen del Tesseroid


## Methodology

The gravitational potential generated by a Tesseroid with variable density in depth is
defined by the following integral:

```
\begin{equation}
    V(r,\phi,\lambda) = G
    \int\limits_{\lambda_1}^{\lambda_2}
    \int\limits_{\phi_1}^{\phi_2}
    \int\limits_{r_1}^{r_2}
    \frac{\rho(r')}{\ell} {r'}^2 \cos\phi' \,  dr' d\phi' d\lambda'.
\end{equation}
```

This volume integral can be numerically approximated through a GLQ:

```
\begin{equation}
    \int\limits_{\lambda_1}^{\lambda_2}
    \int\limits_{\phi_1}^{\phi_2}
    \int\limits_{r_1}^{r_2}
        \rho(r') \underbrace{f(r', \phi', \lambda')}_\text{integration kernel}
        dr' d\phi' d\lambda'
    \approx
    A
    \sum\limits_{i=1}^{N^r}
    \sum\limits_{j=1}^{N^\phi}
    \sum\limits_{k=1}^{N^\lambda}
        \underbrace{W_i^r W_j^\phi W_k^\lambda}_\text{GLQ weights}
        \overbrace{\rho(r_i) f(r_i, \phi_j, \lambda_k)}^\text{evaluated on GLQ nodes}
\end{equation}
```

The **GQL is equivalent** to approximate the tesseroid as **point masses** located on
the nodes of the Quadrature.

> Imagen de GQL nodes

This introduces two sources of errors:
- The approximation becomes less accurate when the computation point gets closer to the
  tesseroid.
- The density function is evaluated only at two depths.


## Two Dimensional Adaptive Discretization

Instead of increasing the GLQ order, an efficient way to reduce the error due to the
distance between the tesseroid and the computation point is to apply discretizations to
the original tesseroid.

**Step 1.** Check if the tesseroid satisfies the following inequality:

```
$$ \frac{d}{L_{\lambda, \phi}} \geq D $$
```

where `d` is the distance from the center of the tesseroid to the computation point,
`L_{\lambda, \phi}` are the longitudinal and latitudinal dimensions of the tesseroid and
`D` is a positive scalar defined as the **distance-size ratio**.

**Step 2.** If none of the dimensions fails the inequality, compute the gravitational
field it generates using a **second-order GLQ**. Add the computed effect to the running
total.

**Step 3.** If the inequality does not hold for one of the dimensions, we **split the
tesseroid in half** along that dimension. Then repeat the steps 1-3 for all smaller
tesseroids until none are left that violate the inequality.

> Imagen adaptive-discretization

**Final step.** A second-order GLQ have been applied to each smaller tesseroid, and the
running total gathered up on step 2 will be the gravitational effect of the original
tesseroid.
